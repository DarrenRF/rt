{% extends "base.html" %} {% block title %}Browse - RealTop{% endblock %} {%
block content_main_class %}ratings-container{% endblock %} {% block content_main
%}
<div class="page-head">
  <p class="title_search">Browse Ratings</p>
  <div class="page-head-right">
    <a href="/add" class="btn-nav pill-action">ADD</a>
  </div>
</div>

<div class="browse-tabs-row">
  <form method="GET" action="/browse" class="order-form">
    {% if active_type and active_type != 'all' %}
    <input type="hidden" name="type" value="{{ active_type }}" />
    {% endif %} {% if pagination %}
    <input type="hidden" name="per_page" value="{{ pagination.per_page }}" />
    {% endif %}
    <label class="sr-only" for="order-browse">Order</label>
    <select id="order-browse" name="order" onchange="this.form.submit()">
      <option value="recent" {{ 'selected' if active_order == 'recent' else '' }}>
        Recent
      </option>
      <option value="oldest" {{ 'selected' if active_order == 'oldest' else '' }}>
        Oldest
      </option>
    </select>
  </form>

  <div class="activity-tabs">
    <a
      class="activity-tab {% if not active_type or active_type == 'all' %}is-active{% endif %}"
      href="/browse?order={{ active_order }}{% if pagination %}&per_page={{ pagination.per_page }}{% endif %}"
      >All</a
    >
    <a
      class="activity-tab {% if active_type == 'songs' %}is-active{% endif %}"
      href="/browse?type=songs&order={{ active_order }}{% if pagination %}&per_page={{ pagination.per_page }}{% endif %}"
      >Songs</a
    >
    <a
      class="activity-tab {% if active_type == 'albums' %}is-active{% endif %}"
      href="/browse?type=albums&order={{ active_order }}{% if pagination %}&per_page={{ pagination.per_page }}{% endif %}"
      >Albums</a
    >
    <a
      class="activity-tab {% if active_type == 'artists' %}is-active{% endif %}"
      href="/browse?type=artists&order={{ active_order }}{% if pagination %}&per_page={{ pagination.per_page }}{% endif %}"
      >Artists</a
    >
  </div>
</div>
{% if not current_user.is_authenticated %}
<p class="auth-hint" style="color: #6b7280; font-style: italic">
  Sign up or log in to add a rating.
</p>
{% endif %} {% if ratings %}
<ul class="rating-list">
  {% for rating in ratings %}
  <li
    onclick="window.location='/rating/{{ rating[0] }}'"
    class="{% if current_user.is_authenticated and rating[8] == current_user.username %}is-owner{% endif %}"
  >
    {% set pct = percent_map.get(rating[0]) if percent_map else None %} {% if
    pct %}
    <span class="rating-percent" aria-hidden="true">{{ pct }}%</span>
    {% endif %} {% set owner_username = rating[8] %}

    <div class="rating-item-left">
      <span class="rating-header">
        <span class="avatar-wrap">
          {% if owner_pics and owner_username in owner_pics and
          owner_pics[owner_username] %}
          <img
            class="avatar"
            src="{{ owner_pics[owner_username] }}"
            alt="{{ owner_username }} avatar"
          />
          {% else %}
          <span class="avatar-initial">{{ owner_username[0]|upper }}</span>
          {% endif %}
        </span>
        <small class="rating-owner">{{ owner_username }}</small>
      </span>
      <span class="rating-item-text">
        <strong>{{ rating[1] }}</strong>: {{ rating[2] }}<br />
        <small>
          Lyrics: {{ rating[3] }} | Beat: {{ rating[4] }} | Flow: {{ rating[5]
          }} | Melody: {{ rating[6] }} | Cohesive: {{ rating[7] }}
        </small>
        {% set reactions = reactions_map.get(rating[0]) if reactions_map else []
        %} {% if reactions %}
        <span class="rating-reactions" aria-hidden="true">
          {% for emoji in reactions %}
          <span class="rating-emoji">{{ emoji }}</span>
          {% endfor %}
        </span>
        {% endif %}
      </span>
    </div>
    <span class="rating-item-actions" onclick="event.stopPropagation()">
      {% if current_user.is_authenticated and rating[8] == current_user.username
      %}
      <span class="rating-action-group">
        <a
          href="/edit/{{ rating[0] }}"
          class="rating-action rating-action-edit"
          onclick="event.stopPropagation()"
          >Edit</a
        >
        <form
          action="/delete/{{ rating[0] }}"
          method="post"
          style="display: inline"
        >
          <button
            type="submit"
            class="rating-action rating-action-delete"
            onclick="
              event.stopPropagation();
              return confirm('Are you sure you want to delete this rating?');
            "
          >
            Ã—
          </button>
        </form>
      </span>
      {% endif %}
    </span>
  </li>
  {% endfor %}
</ul>
{% include "_pagination.html" %} {% else %}
<p style="color: #6b7280; font-style: italic">
  No ratings yet. Click "ADD" to add your first rating!
</p>
{% endif %} {% endblock %}
