{% extends "base.html" %} {% block title %}RealTop{% endblock %} {% block
content_main_class %}ratings-container ratings-home{% endblock %} {% block
content_main %}
<div class="page-head">
  <p class="title_search">Featured Ratings</p>
  <div class="page-head-right">
    <form method="GET" action="/" class="order-form">
      {% if pagination %}
      <input type="hidden" name="per_page" value="{{ pagination.per_page }}" />
      {% endif %}
      <label class="sr-only" for="order-home">Order</label>
      <select id="order-home" name="order" onchange="this.form.submit()">
        <option value="recent" {{ 'selected' if active_order == 'recent' else '' }}>
          Recent
        </option>
        <option value="oldest" {{ 'selected' if active_order == 'oldest' else '' }}>
          Oldest
        </option>
      </select>
    </form>
  </div>
</div>
{% if not current_user.is_authenticated %}
<p class="auth-hint" style="color: #6b7280; font-style: italic">
  Sign up or log in to add a rating.
</p>
{% endif %} {% if ratings %}
<ul class="rating-list">
  {% for rating in ratings %}
  <li
    onclick="window.location='/rating/{{ rating[0] }}'"
    class="{% if current_user.is_authenticated and rating[8] == current_user.username %}is-owner{% endif %}"
  >
    {% set pct = percent_map.get(rating[0]) if percent_map else None %} {% if
    pct %}
    <span class="rating-percent" aria-hidden="true">{{ pct }}%</span>
    {% endif %} {% set owner_username = rating[8] %}
    <div class="rating-item-left">
      <span class="rating-header">
        <span class="avatar-wrap">
          {% if owner_pics and owner_username in owner_pics and
          owner_pics[owner_username] %}
          <img
            class="avatar"
            src="{{ owner_pics[owner_username] }}"
            alt="{{ owner_username }} avatar"
          />
          {% else %}
          <span class="avatar-initial">{{ owner_username[0]|upper }}</span>
          {% endif %}
        </span>
        <small class="rating-owner">{{ owner_username }}</small>
      </span>
      <span class="rating-item-text">
        <strong>{{ rating[1] }}</strong>: {{ rating[2] }}<br />
        <small>
          Lyrics: {{ rating[3] }} | Beat: {{ rating[4] }} | Flow: {{ rating[5]
          }} | Melody: {{ rating[6] }} | Cohesive: {{ rating[7] }}
        </small>
        {% set reactions = reactions_map.get(rating[0]) if reactions_map else []
        %} {% if reactions %}
        <span class="rating-reactions" aria-hidden="true">
          {% for emoji in reactions %}
          <span class="rating-emoji">{{ emoji }}</span>
          {% endfor %}
        </span>
        {% endif %}
      </span>
    </div>
    <span class="rating-item-actions" onclick="event.stopPropagation()">
      {% if current_user.is_authenticated and rating[8] == current_user.username
      %}
      <span class="rating-action-group">
        <a
          href="/edit/{{ rating[0] }}"
          class="rating-action rating-action-edit"
          onclick="event.stopPropagation()"
          >Edit</a
        >
        <form
          action="/delete/{{ rating[0] }}"
          method="post"
          style="display: inline"
        >
          <button
            type="submit"
            class="rating-action rating-action-delete"
            onclick="
              event.stopPropagation();
              return confirm('Are you sure you want to delete this rating?');
            "
          >
            Ã—
          </button>
        </form>
      </span>
      {% endif %}
    </span>
  </li>
  {% endfor %}
</ul>

{% include "_pagination.html" %} {% else %}
<p style="color: #6b7280; font-style: italic">No ratings yet.</p>
{% endif %} {% endblock %}
